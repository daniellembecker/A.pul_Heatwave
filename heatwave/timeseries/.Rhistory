# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)
# Chunk 2
## install packages if you dont already have them
if (!require("tidyverse")) install.packages("tidyverse")
if (!require("ggplot2")) install.packages("ggplot2")
if (!require("RColorBrewer")) install.packages("RColorBrewer")
if (!require("lme4")) install.packages("lme4")
if (!require("lmerTest")) install.packages("lmerTest")
if (!require("car")) install.packages("car")
if (!require("effects")) install.packages("effects")
if (!require("ggfortify")) install.packages("ggfortify")
if (!require("cowplot")) install.packages("cowplot")
if (!require("vegan")) install.packages("vegan")
if (!require("corrr")) install.packages("corrr")
if (!require("ggcorrplot")) install.packages("ggcorrplot")
if (!require("GGally")) install.packages("GGally")
if (!require("broom")) install.packages("broom")
if (!require("cowplot")) install.packages("cowplot")
# load packages
library(tidyverse)
library(ggplot2)
library(RColorBrewer)
library(lme4)
library(lmerTest)
library(car)
library(effects)
library(ggfortify)
library(cowplot)
library(vegan)
library(corrr)
library(ggcorrplot)
library(GGally)
library(broom)
library(cowplot)
# Chunk 3
master<-read.csv("timeseries_analysis/Output/master_timeseries.csv")
#remove notes column to remove NAs
master <- master[, -29]  # Remove the 28th column
# Chunk 4
#remove outlier cells.cm for plot from TP3
master.sym <- master %>%
filter(cells.cm2 < 3000000)
#create plot
symbplot_cm2<-master.sym %>%
filter(!is.na(cells.cm2)) %>%
filter(!is.na(timepoint))%>%
select(fragment_ID, timepoint, treatment, cells.cm2)%>%
ggplot(., aes(x = timepoint, y = cells.cm2, fill = treatment)) +
geom_boxplot(outlier.size = 0) +
geom_point(pch = 21, size=2, position = position_jitterdodge(0.2)) +
scale_fill_manual(values = c("blue", "red", "gray"), labels=c("ambient", "hot", "initial"))+
labs(fill = "Treatment") +
#facet_wrap(~timepoint) +
scale_y_continuous(labels = scales::label_scientific())+ # Use scientific notation on y-axis
xlab("Timepoint") +
ylab(expression(bold(paste("Symbiont Cells cm"^-2))))+
theme_classic() +
theme(legend.position = c(.95, .90),
legend.justification = c("right", "top"),
legend.title=element_text(face="bold", size=30),
legend.text=element_text(size=28),
axis.title=element_text(face="bold", size=30),
axis.text=element_text(size=30, color="black"),
strip.text.x=element_text(face="italic", size=20)
); symbplot_cm2
# Chunk 5
#remove outlier host prot mg.cm2 for plot from TP3, TP5, and TP1
master.host.prot <- master %>%
filter(host_prot_mg.cm2 < 1.00)
master.host.prot <- master.host.prot %>%
filter(host_prot_mg.cm2 > 0.20)
#create plot
host_prot_cm2<-master.host.prot %>%
filter(!is.na(host_prot_mg.cm2)) %>%
filter(!is.na(timepoint))%>%
select(fragment_ID, timepoint, treatment, host_prot_mg.cm2)%>%
ggplot(., aes(x = timepoint, y = host_prot_mg.cm2, fill = treatment)) +
geom_boxplot(outlier.size = 0) +
geom_point(pch = 21, size=2, position = position_jitterdodge(0.2)) +
scale_fill_manual(values = c("blue", "red", "gray"), labels=c("ambient", "hot", "initial"))+
labs(fill = "Treatment") +
#facet_wrap(~timepoint) +
xlab("Timepoint") +
ylab(expression(bold(paste("Host Protein ( mg cm"^-2, ")"))))+
theme_classic() +
theme(
legend.title=element_text(face="bold", size=30),
legend.text=element_text(size=28),
legend.position = "none",
axis.title=element_text(face="bold", size=30),
axis.text=element_text(size=30, color="black"),
strip.text.x=element_text(face="italic", size=20)
); host_prot_cm2
# Chunk 6
#remove outlier holo prot mg.cm2 for plot from TP3, TP5
master.holo.prot <- master %>%
filter(holobiont_prot_mg.cm2 < 1.25)
#create plot
holobiont_prot_cm2<-master.holo.prot %>%
filter(!is.na(holobiont_prot_mg.cm2)) %>%
filter(!is.na(timepoint))%>%
select(fragment_ID, timepoint, treatment, holobiont_prot_mg.cm2)%>%
ggplot(., aes(x = timepoint, y = holobiont_prot_mg.cm2, fill = treatment)) +
geom_boxplot(outlier.size = 0) +
geom_point(pch = 21, size=2, position = position_jitterdodge(0.2)) +
scale_fill_manual(values = c("blue", "red", "gray"), labels=c("ambient", "hot", "initial"))+
labs(fill = "Treatment") +
#facet_wrap(~timepoint) +
xlab("Timepoint") +
ylab(expression(bold(paste("Holobiont Protein (mg cm"^-2, ")"))))+
theme_classic() +
theme(
legend.title=element_text(face="bold", size=20),
legend.text=element_text(size=20),
legend.position = "none",
axis.title=element_text(face="bold", size=30),
axis.text=element_text(size=30, color="black"),
strip.text.x=element_text(face="italic", size=20)
); holobiont_prot_cm2
# Chunk 7
#remove outlier chla.ug cm2 for plot from TP3, TP5
master.chl <- master %>%
filter(chla.ug.cm2 < 5.50)
#create plot
chla_cm2<-master.chl %>%
filter(!is.na(chla.ug.cm2)) %>%
filter(!is.na(timepoint))%>%
select(fragment_ID, timepoint, treatment, chla.ug.cm2)%>%
ggplot(., aes(x = timepoint, y = chla.ug.cm2, fill = treatment)) +
geom_boxplot(outlier.size = 0) +
geom_point(pch = 21, size=2, position = position_jitterdodge(0.2)) +
scale_fill_manual(values = c("blue", "red", "gray"), labels=c("ambient", "hot", "initial"))+
labs(fill = "Treatment") +
#facet_wrap(~timepoint) +
xlab("Timepoint") +
ylab(expression(bold(paste("Chlorophyll a (", mu, "g cm"^-2, ")"))))+
theme_classic() +
theme(
legend.title=element_text(face="bold", size=20),
legend.text=element_text(size=20),
legend.position = "none",
axis.title=element_text(face="bold", size=30),
axis.text=element_text(size=30, color="black"),
strip.text.x=element_text(face="italic", size=20)
); chla_cm2
# Chunk 8
# Define the specific timepoint
specific_timepoint <- "TP5"
# Define the chlc2.ug.cm2 threshold for outlier detection
threshold <- 1.88
# Filter the data to remove the outlier point at timepoint 5
filtered_master <- master %>%
filter(!(timepoint == specific_timepoint & chlc2.ug.cm2 > threshold))
#create plot
chlc_prot_cm2<-filtered_master %>%
filter(!is.na(chlc2.ug.cm2)) %>%
filter(!is.na(timepoint))%>%
select(fragment_ID, timepoint, treatment, chlc2.ug.cm2)%>%
ggplot(., aes(x = timepoint, y = chlc2.ug.cm2, fill = treatment)) +
geom_boxplot(outlier.size = 0) +
geom_point(pch = 21, size=2, position = position_jitterdodge(0.2)) +
scale_fill_manual(values = c("blue", "red", "gray"), labels=c("ambient", "hot", "initial"))+
labs(fill = "Treatment") +
#facet_wrap(~timepoint) +
xlab("Timepoint") +
ylab(expression(bold(paste("Chlorophyll c2 (", mu, "g cm"^-2, ")"))))+
theme_classic() +
theme(
legend.title=element_text(face="bold", size=20),
legend.text=element_text(size=20),
legend.position = "none",
axis.title=element_text(face="bold", size=30),
axis.text=element_text(size=30, color="black"),
strip.text.x=element_text(face="italic", size=20)
); chlc_prot_cm2
# Chunk 9
# Define the specific timepoint
specific_timepoint <- "TP5"
# Define the total chl threshold for outlier detection
threshold <- 5
# Filter the data to remove the outlier point at timepoint 5
filtered_master.tot.chl <- master %>%
filter(!(timepoint == specific_timepoint & Total_Chl_cm2 > threshold))
# filter outlier for tp3
filtered_master.tot.chl <- filtered_master.tot.chl %>%
filter(Total_Chl_cm2 < 10)
#create plot
tot_chl <- filtered_master.tot.chl %>%
filter(!is.na(Total_Chl_cm2)) %>%
filter(!is.na(timepoint))%>%
select(fragment_ID, timepoint, treatment, Total_Chl_cm2)%>%
ggplot(., aes(x = timepoint, y = Total_Chl_cm2, fill = treatment)) +
geom_boxplot(outlier.size = 0) +
geom_point(pch = 21, size=2, position = position_jitterdodge(0.2)) +
scale_fill_manual(values = c("blue", "red", "gray"), labels=c("ambient", "hot", "initial"))+
labs(fill = "Treatment") +
#facet_wrap(~timepoint) +
xlab("Timepoint") +
ylab(expression(bold(paste("Total Chlorophyll (", mu, "g cm"^-2, ")"))))+
theme_classic() +
theme(
legend.title=element_text(face="bold", size=20),
legend.text=element_text(size=20),
legend.position = "none",
axis.title=element_text(face="bold", size=30),
axis.text=element_text(size=30, color="black"),
strip.text.x=element_text(face="italic", size=20)
); tot_chl
# Chunk 10
phys_figure<-plot_grid(symbplot_cm2, chla_cm2, chlc_prot_cm2, tot_chl, host_prot_cm2, holobiont_prot_cm2, ncol=3, nrow=2, labels = c('A', 'B', 'C', 'D', 'E', 'F'),rel_heights= c(1,1,1,1), rel_widths = c(1,1,1,1.2), label_y=1, align="h", label_size = 50)
ggsave(filename="timeseries_analysis/Figures/Phys_Figure.pdf", plot=phys_figure, dpi=300, width=30, height=25, units="in")
ggsave(filename="timeseries_analysis/Figures/Phys_Figure.png", plot=phys_figure, dpi=300, width=30, height=25, units="in")
# Chunk 11
master <- master %>%
filter(!is.na(treatment) & treatment != "initial")
# Chunk 12
sym_model<-lmer(cells.cm2~timepoint*treatment + (1|colony_ID), na.action=na.omit, data=master)
qqPlot(residuals(sym_model))
# Chunk 13
sym_model<-lmer(log(cells.cm2~timepoint*treatment+(1|colony_ID), na.action=na.omit, data=master))
